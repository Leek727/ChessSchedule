<!--contains entire compiled html for frontend-->
<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Chess Tournament Manager</title>
    <link rel="stylesheet" href="/static/main.css">
    <!-- alpine mask extension -->
    <script defer src="https://unpkg.com/@alpinejs/mask@3.x.x/dist/cdn.min.js"></script>
    <!-- alpine router extention -->
    <script src="https://unpkg.com/@shaun/alpinejs-router@1.x.x/dist/cdn.min.js" defer></script>
    <!-- alpine js -->
    <script defer src="https://unpkg.com/alpinejs@3.x.x/dist/cdn.min.js"></script>
    <!-- socket io -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js" integrity="sha512-q/dWJ3kcmjBLU4Qc47E4A9kTB4m3wuTY7vkFJDTZKjTs8jhyGQnaUrxa0Ytd0ssMZhbNua9hE+E7Qv1j+DyZwA==" crossorigin="anonymous"></script>
    
</head>
<!-- set router mode to use hash -->
<body x-data="socketManager()">
    <!-- home page -->
    <template x-route="/">
       <section class="hero is-fullheight">
  <div class="hero-head has-text-centered">
    <span class="is-size-2">Chess Tournament</span>
  </div>
  <div class="hero-body has-text-centered">
    <div class="container">
      <a x-link href="/join" class="button is-primary is-large">Join Game</a>
      <br />
      <span class="is-size-3">- OR -</span>
      <br />
      <a @click="createRoom()" class="button is-light is-large">Create Game</a>
    </div>
  </div>
</section> 
    </template>
    <template x-route="/join">
       <section
  x-data="joinRoomHandler(parent.socket, parent)"
  class="hero is-fullheight has-text-centered"
>
  <div class="hero-body">
    <div class="container">
      <div x-show="!joinedRoom">
        <p class="block is-size-2">Enter Join Code</p>
        <div class="join-input block">
          <input
            x-model="code"
            x-mask="9999999"
            class="input is-large"
            placeholder="1234567"
            maxlength="7"
            required
          />
        </div>

        <div x-text="error" class="error-msg"></div>

        <div class="block">
          <button
            @click="checkCode()"
            :disabled="code.length != 7"
            class="mt-4 button is-primary is-large"
          >
            Join Competition
          </button>
        </div>
      </div>
      <div x-show="joinedRoom">
        <p class="block is-size-2">Enter Your Name</p>
        <div class="join-input block">
          <input
            @input.debounce.250ms="checkName()"
            x-model="name"
            class="input is-large"
            placeholder="Jason Quang"
            maxlength="14"
            
          />
        </div>
        <p class="block is-size-2">Select Skill Level</p>
        <div class="skill-input block">
          <button
            class="button"
            :class="skill==1 ? 'is-focused' : null"
            @click="setSkill(1)"
          >
            <img src="static/assets/pawn.png" />
          </button>
          <button
            class="button"
            :class="skill==2 ? 'is-focused' : null"
            @click="setSkill(2)"
          >
            <img src="static/assets/knight.png" />
          </button>
          <button
            class="button"
            :class="skill==3 ? 'is-focused' : null"
            @click="setSkill(3)"
          >
            <img src="static/assets/bishop.png" />
          </button>
          <button
            class="button"
            :class="skill==4 ? 'is-focused' : null"
            @click="setSkill(4)"
          >
            <img src="static/assets/rook.png" />
          </button>
          <button
            class="button"
            :class="skill==5 ? 'is-focused' : null"
            @click="setSkill(5)"
          >
            <img src="static/assets/queen.png" />
          </button>
        </div>

        <!-- error variable is reused for both forms -->
        <div x-text="error" class="error-msg"></div>

        <div class="block">
          <button
            @click="joinRoom()"
            :disabled="name.length < 3 || !validName || skill === null"
            class="mt-4 button is-primary is-large"
          >
            Join
          </button>
        </div>
      </div>
    </div>
  </div>
</section> 
    </template>
    <template x-route="/create">
        <section
  x-data="createRoomHandler(socket, parent)"
  x-init="$nextTick(() => init())"
>
  <div class="columns is-centered has-text-centered">
    <div class="column">
      <div>
        <h1 x-text="roomCode" class="join-code"></h1>
      </div>
      <br />
      <span class="is-size-2">Join Code</span>
    </div>
  </div>
  <div class="columns is-multiline is-centered" style="min-height: 30rem;">
    <template x-for="player in players">
      <div>
        <h1 x-text="player.name" class="player-tile"></h1>
      </div>
    </template>
  </div>
  <div class="columns is-centered">
    <button :disabled="players.length < 2" @click="startGame()" class="button is-primary is-large start-btn">Start Tournament</button>
  </div>
</section>
    </template>
    <template x-route="/game/:name/:userUUID">
        <section
  x-data="gameHandler(parent.socket, parent, $router.params.userUUID)"
  class="has-text-centered"
>
    <div class="container">
      <!-- waiting room -->
      <h1 class="is-size-2 my-6" x-show="!gameStarted">
        Hey <span x-text="decodeURI($router.params.name)"></span>! See your name on the
        screen?
      
      </h1>
      <template x-if="gameStarted && !showLeaderboard">
        <div class="columns is-centered">
  <div class="column">
    <!-- container for the game completed button and game messages -->
    <div class="my-6">
      <!-- only show button if it is not a bye -->
      <button
        x-show="!isBye && !gameSubmitted"
        @click="$refs.selectModal.classList.add('is-active')"
        class="button is-primary is-large"
      >
        Game Completed
      </button>
      <h1 x-ref="gameSubmitMsg" x-show="gameSubmitted && !isBye" class="is-size-2"></h1>
      <!-- show this message if it is a bye -->
      <h1 x-show="isBye" class="is-size-2">Unlucky! Please go spectate the other matches.</h1>
    </div>
    <!-- modal for selection -->
    <div x-ref="selectModal" class="modal">
  <div class="modal-background"></div>

  <div class="modal-content">
    <div class="box mx-1">
      <h1 class="is-size-2">Who Won This Round?</h1>
      <!-- selection buttons  -->
      <div class="buttons has-addons are-large is-centered">
        <!-- when a button is click, change winSelected to the uuid of the player selected then add the 'is-selected' class to the button -->
        <button
          @click="winSelected = playerPair[0].uuid"
          x-text="playerPair[0].name"
          class="button"
          :class="winSelected == playerPair[0].uuid ? 'is-focused' : ''"
        ></button>
        <button
          @click="winSelected = playerPair[1].uuid"
          x-text="playerPair[1].name"
          class="button"
          :class="winSelected == playerPair[1].uuid ? 'is-focused' : ''"
        ></button>
        <button
          @click="winSelected = 'draw'"
          class="button"
          :class="winSelected == 'draw' ? 'is-focused' : ''"
        >Draw / Stalemate</button>
      </div>
      <br />
      <!-- submit button -->
      <button
        @click="submitGameResult()"
        x-show="winSelected !== null"
        class="button is-primary is-medium"
      >
        Confirm Selection
      </button>
    </div>
  </div>

  <button class="modal-close is-large" aria-label="close"></button>
</div>
    <div class="pairings box mx-2">
      <template x-for="pair in pairings">
        <div>
          <!-- even amount of players -->
          <template x-if="pair.length == 2">
            <h1
              class="pair-tile"
              :class="{ 'is-player-pair' : playerPair === pair}"
            >
              <span x-text="pair[0].name"></span>
              <span x-text="pair[1].name"></span>
            </h1>
          </template>
          <!-- uneven amount of players -->
          <template x-if="pair.length == 1">
            <h1
              class="pair-tile"
              :class="{ 'is-player-pair' : playerPair === pair}"
            >
              <span x-text="pair[0].name"></span> <span>Bye - Sitout :(</span>
            </h1>
          </template>
        </div>
      </template>
    </div>
  </div>
</div>
      </template>


       <template x-if="showLeaderboard">
        <section x-data="leaderboardHandler(parent.socket, parent)">
  <div class="columns is-full-mobile is-two-thirds is-centered" style="justify-content: center">
    <div class="column">
      <div class="box my-6 leaderboard">
        <div>
          <h1 class="title">Leaderboard</h1>
          <hr />
        </div>
        <table
          class="table"
        >
          <thead>
            <tr>
              <th>Name</th>
              <th>Wins</th>
              <th>Draws</th>
              <th>Losses</th>
              <th>ELO</th>
            </tr>
          </thead>

          <tbody>
            <template x-for="player in players">
              <tr>
                <td><span x-text="player.name"></span></td>
                <td><span x-text="player.score[0]"></span></td>
                <td><span x-text="player.score[1]"></span></td>
                <td><span x-text="player.score[2]"></span></td>
                <td><span x-text="player.score[3]"></span></td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>
      </template>
    
    </div>
</section>
    </template>
    <template x-route="/host/:roomUUID">
        <section x-data="hostHandler(parent.socket, parent, $router.params.roomUUID)">
  <div class="has-text-centered">
    <div class="pairings box mx-2" style="width:30rem ;">
      <template x-for="pair in pairings">
        <div>
          <!-- even amount of players -->
          <template x-if="pair.length == 2">
            <h1 class="pair-tile">
              <span x-text="pair[0].name"></span>
              <span x-text="pair[1].name"></span>
            </h1>
          </template>
          <!-- uneven amount of players -->
          <template x-if="pair.length == 1">
            <h1 class="pair-tile">
              <span x-text="pair[0].name"></span>
              <span>Bye - Sitout :(</span>
            </h1>
          </template>
        </div>
      </template>
    </div>
    <section x-data="leaderboardHandler(parent.socket, parent)">
  <div class="columns is-full-mobile is-two-thirds is-centered" style="justify-content: center">
    <div class="column">
      <div class="box my-6 leaderboard">
        <div>
          <h1 class="title">Leaderboard</h1>
          <hr />
        </div>
        <table
          class="table"
        >
          <thead>
            <tr>
              <th>Name</th>
              <th>Wins</th>
              <th>Draws</th>
              <th>Losses</th>
              <th>ELO</th>
            </tr>
          </thead>

          <tbody>
            <template x-for="player in players">
              <tr>
                <td><span x-text="player.name"></span></td>
                <td><span x-text="player.score[0]"></span></td>
                <td><span x-text="player.score[1]"></span></td>
                <td><span x-text="player.score[2]"></span></td>
                <td><span x-text="player.score[3]"></span></td>
              </tr>
            </template>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</section>
  </div>
  <div class="buttons">
    <button @click="nextRound()" class="button is-primary">Next Round</button>
    <button @click="endGame()" class="button is-danger">End Game</button>
  </div>
</section>
    </template>
    <template x-route="/results/:results">
        <section x-data="{ results : JSON.parse(decodeURI($router.params.results)).rankings}">
  <div
    class="columns is-centered mx-3"
    style="justify-content: center"
  >
    <div class="column is-full-mobile is-two-thirds">
      <div class="box my-6 leaderboard has-text-centered">
        <div>
          <h1 class="title">Final Game Results</h1>
          <hr />
        </div>
        <table class="table">
          <thead>
            <tr>
              <th>Name</th>
              <th>Wins</th>
              <th>Draws</th>
              <th>Losses</th>
              <th>ELO</th>
            </tr>
          </thead>
          <tbody>
            <template x-for="result in results">
              <tr>
                <td><span x-text="result.name"></span></td>
                <td><span x-text="result.score[0]"></span></td>
                <td><span x-text="result.score[1]"></span></td>
                <td><span x-text="result.score[2]"></span></td>
                <td><span x-text="result.score[3]"></span></td>
              </tr>
            </template>
          </tbody>
        </table>
        <button @click="() => {
            navigator.clipboard.writeText(location.href); 
            $el.innerText = 'Link Copied!';
        }" class="button is-link is-medium my-4">Share Results</button>
      </div>
    </div>
  </div>
</section>
    </template>

    <script src="/static/index.js"></script>
</body>
</html>